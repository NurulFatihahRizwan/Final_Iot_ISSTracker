<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ISS Database Viewer</title>
<style>
body{background:#0a0e27;color:#e8eaf6;font-family:'Space Grotesk',sans-serif;padding:30px;}
h1{margin-bottom:20px;}
button{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:10px;border:1px solid rgba(255,255,255,0.1);}
th{background: rgba(102,126,234,0.2);}
.pagination{margin-top:20px;display:flex;gap:10px;align-items:center;}
</style>
</head>
<body>
<h1>ISS Database Records</h1>
<button id="downloadCsv">üì• Download CSV</button>
<div class="pagination">
  <button id="prevPage">‚Üê Previous</button>
  <span>Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
  <button id="nextPage">Next ‚Üí</button>
</div>
<table>
<thead>
<tr><th>ID</th><th>Timestamp</th><th>Day</th><th>Latitude</th><th>Longitude</th><th>Altitude</th></tr>
</thead>
<tbody id="tableBody"><tr><td colspan="6">Loading...</td></tr></tbody>
</table>

<script>
let currentPage=1, totalPages=1, perPage=1000;

async function fetchData(){
  const res = await fetch(`/api/all-records?page=${currentPage}&per_page=${perPage}`);
  const data = await res.json();
  totalPages = data.total_pages;
  document.getElementById('currentPage').innerText=currentPage;
  document.getElementById('totalPages').innerText=totalPages;

  const tbody = document.getElementById('tableBody');
  tbody.innerHTML='';
  if(data.records.length===0){ tbody.innerHTML='<tr><td colspan="6">No data</td></tr>'; return;}
  data.records.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.ts_utc}</td><td>${r.day}</td><td>${r.latitude.toFixed(4)}</td><td>${r.longitude.toFixed(4)}</td><td>${r.altitude.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('prevPage').onclick=()=>{
  if(currentPage>1){ currentPage--; fetchData(); }
};
document.getElementById('nextPage').onclick=()=>{
  if(currentPage<totalPages){ currentPage++; fetchData(); }
};
document.getElementById('downloadCsv').onclick=()=>{
  window.location.href='/api/all-records?page=1&per_page=5000'; // fetch max records
};

fetchData();
</script>
</body>
</html>
