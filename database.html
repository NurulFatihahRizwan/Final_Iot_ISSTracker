<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ISS Database Viewer</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Space Grotesk', sans-serif;
  background: #0a0e27; color: #e8eaf6; min-height: 100vh; position: relative;
}
body::before {
  content: ''; position: fixed; width: 200%; height: 200%; top: -50%; left: -50%; z-index: -1;
  background: radial-gradient(circle at 20% 50%, rgba(120,119,198,0.3), transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(33,150,243,0.3), transparent 50%);
  animation: drift 20s ease-in-out infinite;
}
@keyframes drift { 0%,100%{transform:translate(0,0);}50%{transform:translate(30px,-30px);} }

header {
  background: rgba(10,14,39,0.8); backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255,255,255,0.08); padding: 20px 40px;
  display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap:20px;
}
.title { font-size:28px; font-weight:700; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
-webkit-background-clip:text; -webkit-text-fill-color:transparent; display:flex; align-items:center; gap:12px; }
.back-btn {
  background: linear-gradient(135deg,#667eea,#764ba2); border:none; color:white; padding:12px 24px; border-radius:8px;
  font-weight:600; cursor:pointer; font-size:14px; text-decoration:none; display:inline-block;
}
.back-btn:hover { transform:translateY(-2px); box-shadow:0 5px 20px rgba(102,126,234,0.4); }

.container { max-width:1400px; margin:0 auto; padding:40px 20px; }

.stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
.stat-box { background: linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));
border:1px solid rgba(102,126,234,0.2); border-radius:16px; padding:20px; text-align:center; transition:transform 0.3s ease;}
.stat-box:hover { transform:translateY(-4px); }
.stat-label { font-size:12px; text-transform:uppercase; letter-spacing:1px; color: rgba(232,234,246,0.6); margin-bottom:10px; }
.stat-value { font-size:32px; font-weight:700; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
-webkit-background-clip:text; -webkit-text-fill-color:transparent; }

.controls {
  background: rgba(10,14,39,0.6); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.08);
  border-radius:16px; padding:30px; margin-bottom:30px;
}
.controls button {
  background: rgba(102,126,234,0.2); border:1px solid rgba(102,126,234,0.4); color:#667eea;
  padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:600; font-size:14px; margin-right:10px;
  transition:all 0.3s; font-family:'Space Grotesk',sans-serif;
}
.controls button:hover { background: rgba(102,126,234,0.3); transform:translateY(-2px); box-shadow:0 4px 12px rgba(102,126,234,0.3); }

.table-container { background: rgba(10,14,39,0.6); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.08);
border-radius:16px; overflow:hidden; margin-bottom:30px; }
table { width:100%; border-collapse:collapse; }
thead { background: linear-gradient(135deg,rgba(102,126,234,0.15),rgba(118,75,162,0.15)); position:sticky; top:0; z-index:10; }
th { padding:16px 12px; font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:1px; color:rgba(232,234,246,0.8); text-align:left; border-bottom:2px solid rgba(102,126,234,0.3);}
td { padding:14px 12px; font-size:13px; color:rgba(232,234,246,0.8); border-bottom:1px solid rgba(255,255,255,0.05); font-weight:500;}
tbody tr:hover { background: rgba(102,126,234,0.08); }
.day-badge { background: rgba(16,185,129,0.15); border:1px solid rgba(16,185,129,0.3); padding:4px 10px; border-radius:8px; font-weight:600; color:#10b981; display:inline-block; font-size:11px; }

.pagination { display:flex; justify-content:center; align-items:center; gap:10px; margin-top:30px; flex-wrap:wrap; }
.pagination button { background: rgba(102,126,234,0.2); border:1px solid rgba(102,126,234,0.4); color:#667eea; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:600; font-size:14px; }
.pagination button:hover:not(:disabled) { background: rgba(102,126,234,0.3); transform:translateY(-2px); box-shadow:0 4px 12px rgba(102,126,234,0.3);}
.pagination button:disabled { opacity:0.3; cursor:not-allowed; }
.pagination span { color:rgba(232,234,246,0.8); font-weight:600; padding:0 10px; }

@media (max-width:768px){
header { padding:15px 20px; } .title{ font-size:22px; } .container{ padding:20px 15px;}
.stats{ grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:15px; } .stat-value{ font-size:24px;}
table{ font-size:12px;} th, td{padding:10px 8px;}
}
</style>
</head>
<body>
<header>
  <h1 class="title">üìä ISS Database Viewer</h1>
  <a href="/" class="back-btn">‚Üê Back to Dashboard</a>
</header>

<div class="container">
  <div class="stats" id="statsContainer">
    <div class="stat-box">
      <div class="stat-label">Total Records</div>
      <div class="stat-value" id="totalRecords">--</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Current Page</div>
      <div class="stat-value" id="currentPage">--</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Total Pages</div>
      <div class="stat-value" id="totalPages">--</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Records/Page</div>
      <div class="stat-value" id="perPage">1000</div>
    </div>
  </div>

  <div class="controls">
    <button onclick="downloadCSV(false)">üìÖ Download Selected Day CSV</button>
    <button onclick="downloadCSV(true)">üìÇ Download All Records CSV</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Record ID</th>
          <th>Timestamp (UTC)</th>
          <th>Day</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Altitude (km)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td colspan="6" class="loading">Loading data...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <button onclick="goToPage(1)" id="firstBtn">‚èÆ First</button>
    <button onclick="goToPrev()" id="prevBtn">‚Üê Previous</button>
    <span id="pageInfo">Page 1 of 1</span>
    <button onclick="goToNext()" id="nextBtn">Next ‚Üí</button>
    <button onclick="goToPage(totalPages)" id="lastBtn">Last ‚è≠</button>
  </div>
</div>

<script>
let currentPage = 1;
let totalPages = 1;
let perPage = 1000;
let selectedDay = '';

async function fetchData(page = 1) {
  try {
    const params = new URLSearchParams({ page, per_page: perPage });
    if(selectedDay) params.append('day', selectedDay);
    const response = await fetch(`/api/all-records?${params}`);
    const data = await response.json();
    currentPage = data.page;
    totalPages = data.total_pages;
    updateStats(data);
    updateTable(data.records);
    updatePagination();
    if(data.available_days.length) selectedDay = data.available_days[0]; // default current day
  } catch (err) { console.error(err); displayError(); }
}

function updateStats(data){
  document.getElementById('totalRecords').textContent = data.total.toLocaleString();
  document.getElementById('currentPage').textContent = currentPage;
  document.getElementById('totalPages').textContent = totalPages;
  document.getElementById('perPage').textContent = perPage;
}

function updateTable(records){
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';
  if(records.length===0){
    tbody.innerHTML='<tr><td colspan="6" class="loading">No records found</td></tr>';
    return;
  }
  records.forEach(r=>{
    const row = document.createElement('tr');
    row.innerHTML=`<td>#${r.id}</td><td>${r.ts_utc}</td><td><span class="day-badge">${r.day}</span></td>
    <td>${Number(r.latitude).toFixed(4)}¬∞</td><td>${Number(r.longitude).toFixed(4)}¬∞</td>
    <td>${r.altitude!==null?Number(r.altitude).toFixed(2)+' km':'‚Äî'}</td>`;
    tbody.appendChild(row);
  });
}

function updatePagination(){
  document.getElementById('pageInfo').textContent=`Page ${currentPage} of ${totalPages}`;
  document.getElementById('firstBtn').disabled=currentPage===1;
  document.getElementById('prevBtn').disabled=currentPage===1;
  document.getElementById('nextBtn').disabled=currentPage===totalPages;
  document.getElementById('lastBtn').disabled=currentPage===totalPages;
}

function displayError(){
  document.getElementById('tableBody').innerHTML='<tr><td colspan="6" class="loading" style="color:#ef4444;">Error loading data. Please refresh.</td></tr>';
}

function goToPage(page){ if(page>=1&&page<=totalPages) fetchData(page); }
function goToNext(){ goToPage(currentPage+1); }
function goToPrev(){ goToPage(currentPage-1); }

function downloadCSV(all=false){
  let url='/api/download-csv';
  if(all) url+='?all=1';
  else if(selectedDay) url+='?day='+selectedDay;
  window.open(url);
}

setInterval(()=>fetchData(currentPage),30000);
fetchData(1);
</script>
</body>
</html>
