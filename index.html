<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ISS Tracker Dashboard</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Space Grotesk',sans-serif;background:#0a0e27;color:#e8eaf6;height:100vh;overflow:hidden;}
.main-container{height:100vh;display:flex;flex-direction:column;}
header{background: rgba(10,14,39,0.8);backdrop-filter: blur(20px);padding:20px 40px;display:flex;justify-content:space-between;align-items:center;}
.logo{display:flex;align-items:center;gap:12px;}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;}
.logo-text h1{font-size:22px;font-weight:700;}
.logo-text p{font-size:12px;color:rgba(232,234,246,0.5);}
.live-badge{display:flex;align-items:center;gap:8px;background: rgba(16,185,129,0.1);border-radius:20px;padding:8px 16px;font-size:13px;font-weight:500;}
.live-dot{width:8px;height:8px;background:#10b981;border-radius:50%;animation: blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}
.content-wrapper{flex:1;display:grid;grid-template-columns:1fr 420px;overflow:hidden;}
.map-container{position:relative;background:#000;}
#map{width:100%;height:100%;}
.analytics-sidebar{background: rgba(10,14,39,0.6);backdrop-filter:blur(20px);border-left:1px solid rgba(255,255,255,0.08);overflow-y:auto;padding:30px;}
.analytics-sidebar::-webkit-scrollbar{width:6px;}
.analytics-sidebar::-webkit-scrollbar-thumb{background: rgba(102,126,234,0.3);border-radius:3px;}
.section{margin-bottom:40px;}
.section-header{font-size:14px;font-weight:600;text-transform:uppercase;color: rgba(232,234,246,0.5);margin-bottom:20px;display:flex;align-items:center;gap:10px;}
.metrics-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;}
.metric-box{background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));border-radius:16px;padding:20px;position:relative;overflow:hidden;}
.metric-label{font-size:11px;font-weight:600;text-transform:uppercase;color:rgba(232,234,246,0.6);margin-bottom:10px;}
.metric-value{font-size:32px;font-weight:700;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.metric-unit{font-size:16px;color: rgba(232,234,246,0.4);}
.data-table{background: rgba(255,255,255,0.02);border-radius:16px;overflow:hidden;}
table{width:100%;border-collapse:collapse;}
thead{background:linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));}
th,td{padding:12px;font-size:13px;color:rgba(232,234,246,0.8);text-align:left;}
tbody tr:hover{background: rgba(102,126,234,0.08);}
.controls{display:flex;gap:10px;align-items:center;margin-top:15px;}
#slider{flex:1;height:8px;border-radius:4px;background:rgba(255,255,255,0.1);}
#playPause{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:white;padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;}
#playPause:hover{transform:translateY(-2px);}
#liveMode{margin-left:10px;}
@media(max-width:1200px){.content-wrapper{grid-template-columns:1fr;grid-template-rows:1fr auto;}.analytics-sidebar{border-left:none;border-top:1px solid rgba(255,255,255,0.08);max-height:40vh;}}
</style>
</head>
<body>
<div class="main-container">
  <header>
    <div class="logo">
      <div class="logo-icon">üõ∞Ô∏è</div>
      <div class="logo-text"><h1>ISS Mission Control</h1><p>Real-time Orbital Tracking</p></div>
    </div>
    <div class="live-badge"><div class="live-dot"></div>Live Tracking</div>
  </header>
  <div class="content-wrapper">
    <div class="map-container"><div id="map"></div></div>
    <div class="analytics-sidebar">
      <div class="section">
        <div class="section-header">Playback Controls</div>
        <div class="controls">
          <input type="range" id="slider" min="0" max="0" value="0">
          <button id="playPause">‚ñ∂ Play</button>
          <label><input type="checkbox" id="liveMode" checked> Live Mode</label>
        </div>
        <div style="margin-top:16px;">
          <a href="/database"><button style="width:100%;background:linear-gradient(135deg,#10b981,#059669);border:none;color:white;padding:12px;border-radius:10px;font-weight:700;">üìä View All Database Records</button></a>
        </div>
      </div>
      <div class="section">
        <div class="section-header">Orbital Metrics</div>
        <div class="metrics-grid">
          <div class="metric-box"><div class="metric-label">Min Longitude</div><div class="metric-value"><span id="min_lon">--</span><span class="metric-unit">¬∞</span></div></div>
          <div class="metric-box"><div class="metric-label">Max Longitude</div><div class="metric-value"><span id="max_lon">--</span><span class="metric-unit">¬∞</span></div></div>
          <div class="metric-box"><div class="metric-label">Min Altitude</div><div class="metric-value"><span id="min_alt">--</span><span class="metric-unit">km</span></div></div>
          <div class="metric-box"><div class="metric-label">Max Altitude</div><div class="metric-value"><span id="max_alt">--</span><span class="metric-unit">km</span></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([0,0],2);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}', {maxZoom:19}).addTo(map);

let issMarker = null, poly = L.polyline([], {color:'#667eea', weight:2.5, opacity:0.9}).addTo(map);
let dataPoints=[], currentIndex=0, playing=false;
const slider = document.getElementById('slider');
const playBtn = document.getElementById('playPause');
const liveMode = document.getElementById('liveMode');

async function fetchData(){
  const res = await fetch('/api/last3days');
  dataPoints = await res.json();
  slider.max = dataPoints.length-1;
  if(currentIndex>=dataPoints.length) currentIndex = dataPoints.length-1;
  updateMap(currentIndex);
}
setInterval(fetchData,2000);

function updateMap(idx){
  if(dataPoints.length===0) return;
  poly.setLatLngs(dataPoints.map(p=>[p.latitude,p.longitude]));
  const d = dataPoints[idx];
  if(!issMarker) issMarker=L.marker([d.latitude,d.longitude]).addTo(map);
  else issMarker.setLatLng([d.latitude,d.longitude]);
  if(liveMode.checked) map.panTo([d.latitude,d.longitude]);
  updateMetrics();
}

function updateMetrics(){
  if(dataPoints.length===0) return;
  const lons = dataPoints.map(p=>p.longitude);
  const alts = dataPoints.map(p=>p.altitude);
  document.getElementById('min_lon').innerText=Math.min(...lons).toFixed(2);
  document.getElementById('max_lon').innerText=Math.max(...lons).toFixed(2);
  document.getElementById('min_alt').innerText=Math.min(...alts).toFixed(2);
  document.getElementById('max_alt').innerText=Math.max(...alts).toFixed(2);
}

slider.oninput = ()=>{ currentIndex=parseInt(slider.value); updateMap(currentIndex); };
playBtn.onclick = ()=>{ playing=!playing; playBtn.innerHTML=playing?'‚è∏ Pause':'‚ñ∂ Play'; };
setInterval(()=>{ if(playing && dataPoints.length>0){ currentIndex=(currentIndex+1)%dataPoints.length; slider.value=currentIndex; updateMap(currentIndex); }},500);
fetchData();
</script>
</body>
</html>
